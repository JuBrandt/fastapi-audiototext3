всем привет от канал вот скотт меня зовут андрей продолжаем разбираться с джокером и у нас на очереди до кирком пауз что такое
это такой инструмент который позволяет нам не просто создавать отдельные образы а запускать их связь
то есть реальная приложения но зачастую состоит не из одного элемента типа приложений а это приложения ну допустим зависит у нас ещё от базу данных а ещё перед нашим предложением у нас может стоять допустим реверсивный прокси именно такую цепочку и попробуй сегодня сделаюсь базу данных приложения и реверсивный прокси в качестве прокси я возьму джинкс же
выступать балансировку нагрузки с помощью какому поводу мы можем связывать наши контейнеры виденном фэй лики конфигурации и запускать всю эту связку единой командой сучку на документацию и на вообще все что вы будете видеть на экране я приложу в описании к видео там жил кстати говоря можете найти информацию о том как подержать канал например но
а также информацию где мы все общаемся в каких чатов какие группу вконтакте и так далее также когда идёте вниз и не забывайте ставить лайки подписаться на канал если вы этого ещё не сделали но я немного увлёкся вернёмся к основной теме нашего ведущие к нам нужно первым делом создать доктор компа у схему файл переходим в консоль где находится наша
приложение которое лежит ноги те я в немного обновил теперь она умеет подключаться к базе данных запускать простенькую миграция если нужно и из базу данных показывает какие у нас есть сообщение и может добавить туда ещё одно новенькое что воском фигурировать наш компост мы создаём новый доктор компост файл и начинаем его потихонечку заполнять по образу и под
обе сильно заморачиваться не будем воле мы посмотрим дальше как делать а сегодня мы сделаем самые элементарные но функциональные доктор файл которую вы можете уже сразу же из использовать первую строчку у нас всегда версия следующий секции мы описываем сервисы добавим сюда заголовок сервисы и пойдём посмотрим чего от нас ожидают ожидают от
нас как раз имена этих самых сервисов а дальше уже идёт конфигурация и это самая конфигурация у нас принципе сильно перекликается с докеров файлом и бы даже наверно с кофе время которое мы передавали в такер файлы вот например команда билл то есть данный образ выполнена нас будет построен из текущей директории ровно так же как если мы запустили доктор билл
как я уже говорил я заморачиваться так сильно не хочу я заранее собрал образом все за пошёл на гид хаб потому что билл ведь не хочу потому что это мне сейчас не очень нужно и поэтому мы будем использовать и мышь как в случае с рэдиссон первым делом и конечно описываем базу данных и вот она у меня уже есть найдено базу данных
и образ мы возьмём одиннадцати четыре а у пайн как наиболее свежей и так пишем что это у нас диабет и за основу мы возьмём и мадж пост грейс версии одинадцать четыре а у пайн что нам дальше нужно сделать здесь кстати говоря это не прописано но на самом деле неплохо было бы указ
контейнеру ещё и имечко потому что до кирком полз сам конечно попытается все эти имена придумать но он их придумать не так ловко как это сделаем мы поэтому берём на себя эту часть работы и название для контейнеры результирующая мы можем указать в параметры контейнерные ты не пускай это будет
по воскрес чтобы было проще потом искать следующие разделы они нам уже знакомы это порты разделы и мент точно такие же аргументом мы указывали когда стартовали наш доктор контейнеры вручную сейчас соответственно мы можем просто указать порт с и задать эти самые пор ты так чтобы нам не приходилось каждый раз
заново естественно у нас это пять четыре три два которое мы опрокидывая пять четыре три два с разделы здесь немного поинтересней мы не хотим чтобы у нас при виде создании нашего контейнера терялась базу данных о чем я ранее вам уже говорил то есть если мы сейчас создадим контейнеры потом их с ними поработаем там окажется какие-либо данные допустим на продакшн не
потом решим пересдать наш контейнеры мы потеряем те самые данные поэтому их нужно вытащить из контейнера поэтому мы сейчас все в базу данных перенесём наружу она будет лежать в той директории откуда мы будем запускать этот самый доктор компост файл чтобы далеко не искать эту самую информацию я сейчас просто создан для викторию да и то и
у меня будут лежать все файлы базу данных на моем реальном компьютере то директории где создаёт доктор фелл будет созданную директория погадать да и то и в будут складываться все эти файлы она холсте которые у нас будет виртуальный по игре складывают все своей внутренности по такому пути вар лип пост вес квейль да
и то да и так далее нам предлагают заполнить январь ненавижу это слово поэтому я его вставлю через копирование и именно там
мы пойдём посмотрим что у нас документация написано нам нужно указать название базу данных чтобы нам и не создавать ручками а также пароль и указывай конечно же после рису где ему искать эти самые файлов которые мы за мной
здесь нам как раз показывают какие дворе был съесть нашего образа первых это поздно
берём его вставляем и указываем что пару минут будет один два три пусть гесс юзерам и оставим не будем заморачиваться от название базу данных кстати говоря подставим и назовём базу данных ская будет джокер тест именно это имя и я выбрал для база данных в приложений и конечно же по и там
вы был которые у нас совпадает должны с этим самым путём
да и то дейта вот он этот путь нам и рекомендует например использовать мы люди послушны мы так и сделаем нам необходимо здесь написать такое аргумент как арестант и в нем и напишем всего одно слово пояс что означает что каждый раз когда нашего приложение диби будет по какой-либо причине останавливаться
но эта причина не будет исходить от нас конкретно вы игрокам позу будет пытаться это делает перезапустить чтобы наше приложение продолжала спокойно работать весьма удобно аргумент и я бы рекомендовал его добавлять к вашим сердцем который действительно должны всегда работать следующий раздел у нас будет для нашего приложение им будет называться соответственно на самом деле вот эти имена
можете придумывать какие хотите так также как вот контейнерные потому что этот полностью ваше творчество которое вам потом и раскурить я выбрал именно вы можете немного по-другому назвать но запоминайте потому что именно по этим нам вы сейчас будете не сейчас а дальше будете связывать все эти приложение именно с этим названиями они друг другу и видят то есть
у нас будет виде базу данных как хвост дебил итак первым делом мы могли бы конечно как я уже говорил написать здесь билд поставить точку и тогда наш образ будет собираться в текущей директории мы пойдём другим путём и напишем сюда и мэдж и мы что у нас опять-таки как я упоминал уже собранный делал подставляя сюда и
я знаю как это все не красиво добавляем но строчку пуская контейнеров
будет порты мы укажем что наше приложение запускается у нас на трёх тысяч на порту соответственно внутренней трёх тысячный мы оставляем наружу также как трёхмесячный после порта в что нам необходимо указать нам необходимо указать инвариант вари бокс
в моем приложений есть такая перемена окружении которую я задал пост кресс хвост вашем приложения нам могут быть какие-то свои дополнительные перемены то есть и то что я просто указываю базу данных который моё предложение должно подключаться потому что костюм для локальная разработки я могу указан
колхоз а вот когда я запускаешь кластере мне нужно знать имя христа на котором будет крутиться это самая базу данных и здесь так как мы запускаем все это позе я могу указать просто имя того контейнера в котором это самая база данных умнее крутятся то есть от он тебе а внутри моего приложения перемены просто
будет ли же как раз этот самый гиви и адрес по которому моё предложение будет обращаться если допустим стиле джей ди бесси строки подключение это будет что-то в духе пост грейс девять допустим имя пользователя пост кресс пароль один два три собака вот она и на холста порт и какая-то моя базу
доктор то есть вот такая получится строка по которой у меня будет подключаться и как раз вот он этот деми он у меня ждёт отсюда то есть если бы я здесь был написал пост
хвост здесь бы у меня ур левую получил свой пост
хвост
и написал бы по с брестская хвост но нам это все не нужно поэтому оставляем только тебе а как уже там все это будет внутри подключаться мы определяем нашим приложений и так далее имечко указываем что мы хотели бы рестор давать также всегда наше приложение и ещё один очень важный момент доктор компост может
стартовать приложении в произвольном порядке он может одновременно запустить контейнеры и мою приложения так как оно сейчас слегка весна может вполне себе раньше ну чем загрузилась базу данных это не очень хорошо потому что естественно у нас посыпятся ошибки именно для этих целей в докеры файле у нас присутствует такое понятие как линки что такое линки это
а не тех контейнеров от которых текущей контейнеру у нас зависит указываем дебил и теперь прежде чем у нас от доктор компост запустит именно базу данных то есть если бы у нас было несколько контейнер допустим ещё нас был боритесь кэш у нас было бы там не знаю допустим время кил мы бы описали эти контейнеры где угодно в ходе
в линков указали что нам ещё предводитель нужно дождаться рэйвен кео нам дождаться на рейде с и что-то ещё возможно и только после старта всех этих сервисов у нас соответственно запустится наш с при конечно мы закончили и далее нам нужно описать наш прокси-сервер конечно же это будет джинкс которую мы так назовём джинкс
имидж которую мы будем использовать и я также заранее нашёл и он нас версии один семнадцать два пять таки чтобы было по легче запускать все это дело легко образ пишем дженнингс и подставляем так контейнер моим неожиданно нас также мкс
небольшой ха чтобы протащить конфигурацию внутри контейнера создадим сейчас дефолт на конфигурацию которую мы про бросим внутрь контейнера в йети си джинкс это будет также дефолт этот файл с пока что очень что сейчас моего создадим в нем будет
у нас настройка которая объясняет к со что и куда и как он должен прогрессировать ну конечно же теперь надо указать линки на те ресурсы от которых зависит зависит он настолько вот такой простенькие такер у нас получился сохраняем выходим и теперь нам нужно сделать тот самый дефолта
в которую мы опишем настройки энджи чтобы он знал куда что и как он должен пить создаём сервер слушать он у нас будет порт восемь девять восемь девять сервер у нас будет
лакея нас будет корневой директории если вы не знакомы с настройками хвостов рекомендую почитать документацию по этому делу к нашему счастью ганс создавали русские ребята и документации на русском языке при достаточно фигурирует он достаточно просто тебя конфигурацию у него на
своеобразным джесс сонечка и достаточно просто понятно все это настраивается и пользуются и в принципе то конфигурацию которая сейчас пытаюсь сделать её можно найти в описаниях конфигурацией сервера от опустим та часть которая сейчас хотел описать я могу я просто скопировать и вставить как мы регулярно
тут делаем за что он не периодически ругает в комментариях единственное что прокси пас мы с вами немножечко поменяем все-таки приложение у нас не на около хвосту а мы должны его получается другого холста который нас другом контейнере находятся на находятся он у нас на хвосте
и на борту три тысячи о чем мы с вами указали в наш вам доктор фэйли вот в этой строчки то есть наш холст называется собственно
ким его и знает и здесь мы указом что вот он наш хвост на трёх тысяч на борту крутятся и энджел должен нам его раздавать простая конфигурация джонсона закончена и теперь можно попробовать все это дело запустить запускается все команда доктор полз и мы можем сейчас посмотрите какие вообще тут у нас есть варианты запуска
эту часть мы пропускаем поскольку она для нас сейчас не сильно информативно ну пожалуй кроме опции если у вас доктор фелл лежит в каком-то файле отличном от название доктор файлу яму либо в по какому-то другому пути но вот эти вот команда они вполне интересные и часть из них мы с вами сейчас изучим только те которые
реально сразу можно применить первым делом нас конечно же интересует команда ап создать и запустить контейнеры соответственно запускаем игрокам полз команды ап и смотре мультик про то как у нас подтягиваются все необходимые образы если у нас указано опция собрать образ соответственно смотрю как все это собирается и видим что энджи
у нас тормознул а все остальные контейнеры вполне себе работают тормозного нас из-за того что я допустила печатать чеку директиве нажимаем контрол со чтобы все притормозить кто не ошибается пусть первый кинет в меня камень и нам нужно поправить не докеры кампус файл
дефолт ком не смотрим да я здесь поставил двоеточие по инерции в среду и то что я не нужны перед запустим наш полосу он теперь станет быстрее потому что все у нас есть и у нас только контейнеры стр тонут видим что никаких ошибок нету
посмотрим что же у нас на привычным порту кстати должен быть доступен да он доступен потому что все сервисов которому стр тонули они на нашей машине также элис на те порты которые у них за экс положены так спортсмену королей сём тормозни он процессы поправим доктор файл пять
надо больше спать и меньше косят что тогда будем нам надо указать порты что мы хотим не просто сползать их мы хотим чтобы у нас из контейнера порт восемь девять восемь девять мы полсон на наружный восемь возьмите и теперь запускаем опять доктор компост об и проверяем что он запросы
идут через нас через наш джинкс сервер здесь должен быть соответствующий заголовки я думаю да вот пожалуйста джинкс все проходит через него добавим сообщение мой план
видим что у нас все это отлично отрабатывает в нашем доме коробкам полз контейнере а теперь немножко поговорим с эти команды которые мы использовали от пожалуйста энджи
все наши запросы чётко видим что все отрабатывает тормозным и посмотрим например а что у нас делают команда доктор старт
стартуют существующей контейнера а какие контейнера она стартует мы можем посмотреть это команды докеров менеджер с отображает контейнеры которые используются до текущем докеров файлом мы видим что у нас используются ты контейнера взятой из каких-то депозитариев с таким то ты гамме общем мы можем получения
массу пути мы джим которую мы задействовали и в каких контейнерах они у нас используются и соответственно теперь если мы напишем доки старт то у нас или контейнеры за пусть отца но в отличие от предыдущего сценария мы видим что у нас нет никаких логов а точно ли все запустилась как я уже упоминал в одном из предыдущих видео у нас есть замечательно
аманда щиток которой мы можем заметить что у нас сервисы действительно запущена но я помню кто-то спрашивал а что делать у меня под подведу эту штуку замечательный не работает можно посмотреть например до кирком полз с и вы увидите все три контейнеры которую у вас сейчас запущена стоит как видим а также нас здесь
как но за мной пленные порты какая команда запущена более того мы можем посмотреть ещё и какие конкретно у нас запущены процессы с помощью команды
для каждого из контейнеров
мы видим все процессы которые запущена и более-менее по ним какую-то информацию о типа процессор на время которое они потребляют и прочие какие-то прелести если мы сейчас узнаем страничку у нас принципе то логов не видно в этом ещё дополнительная проблема но опять-таки здесь все предусмотрены и мы можем набрать команду по услуг с и мы увидим
блоге который у нас идут сейчас в наших контейнеры если посмотреть дополнительную информацию то мы увидим что мы можем даже в принципе следовать нашим блогом ты все если мы запускаем все это префикс набор несколько строчек обновлю страничку добавлю какое-то сообщение и мы видим что это у нас все отлично отображается в наш
но теперь неплохо было бы всю эту тормознуть и для этого у нас также есть команда но как нам пол стоп проверяем что у нас все остановилась да действительно все наши контейнеры остановились в также есть ещё одна замечательная команда которая по своему действие сравнима с небольшим апокалипсиса это команда да она не просто очищает
список запущенных контейнеров она пока она удаляет все существующие ваши контейнеры ну не совсем а только те контейнера которые у вас относились к текущему доктор компост файл и соответственно все сети если они были созданы также удаляет и удалилась сейчас кстати это дело не просто так потому что деккер кампус есть ещё замечательная одна с
способность мы можем не просто запустить наши сервисы но мы можем использовать одну замечательную хитрость опустим наш сервис текущая которое я запуская он написано на ноги а какая она самая большая проблема воды правильно то что надо у нас одна по точный движок с потоками наработать не умеет и если мы хотим
нормально утилизировать нашим нога ядерные сервер а то и ноту думаю должны запускать соответственно несколькими отдельными потоками соответственно мы можем это определить в нашем контейнере но это будет немножечко не тот путь который мы с вами выбрали нам надо бы запустить несколько контейнеров по отдельному контейнеру на каждой инстанции
и это все также предусмотрено
мы можем скорее лить наши ресурсы указывая с помощью флага скел имя и количество винстон со в которую мы хотим запустить как это будет выглядеть в нашем случае выбираем хлеб пишем вскрыл и пишем что мы хотим наш пеп запустить пять потоков но есть одна небольшая проблема в том что мы указали один порт которой мы можем за использо
отредактирован наш доктор файл заранее предупреждаю что мы должны убрать тогда контейнерные им потому что контейнеров будет несколько и одно и то же имя них быть не может соответственно как компост пусть сам теперь уже все это обзывает и порты нам надо указать что наше приложение теперь запускаются не просто на трёх тысяч на борту оно может опускаться на портах
трёх тысяч навал по три тысячи пятой то есть все контейнера у нас при старте
те пять штук которые мы будем стартовать они будут внутренней пор три тысячи поочерёдно мы петь на внешней порты три тысячи тысяча один ты тысяча два тысяча пять у каждого контейнеров будет снаружи торчать один свой порт и после того как мы это дело все сделали нам ещё неплохо было бы поправить наш конфиг на джинкс и потому что он будет по привычки слушать все
но только один порт поэтому мы берём не вот это вот другой файл и здесь нам нужно опять-таки использовать немножечко магии
добавляем такое понятие как трим зовём его допустим пускай будет австрии это тот поток который будет по себе какую-то конфигурацию и наш сервер будет слушать не конкретно какое-то адрес
которые аккумулирует соответственно все эти адреса
просто мы пишем сервер ключевое слово и указываем потом что именно мы хотим слушать слушать мы хотим все тот же самый наш плиты шум
но на портах с трёх тысяч нового здесь к сожалению с недостаточно умён и ему надо указать все варианты которые мы хотим мной но ничего страшного эти кон фиги текстовые поэтому мы можем принципе генерировать с помощью любого чтобы не золота
здесь прокси мы кстати заменяем теперь на ход это по плиткой шон
и теперь стартуем наш доктор полз с указанием скрыл об пять видим что я опять допустила печатать это уже какая-то клиника нужно поправить три слова
рин перезапуск сервер и видим что докеры у нас пытаются запустить сразу наше были конечно пяти инстанциях собственно как и задавал сейчас то что не так восьмой строчки потерял фигурная скобка да я потерял многоточие и
старик закинул невод и в этот раз у нас не притормозил видим что у нас конечно запустился разноцветными строчками в пяти экземплярах и теперь попробуем снова вызвать наше приложение видим что все вроде бы работает попробуем добавить файв добавляется откликается если это дело теперь тормознуть и
и попытаться допустим опять написать доктор компоста то мы видим что у нас стартует как будто бы три приложение но если мы берём в тот же самый стоп или как там полз без то мы увидим что у нас наше приложение страттон его все-таки в пяти инстанциях и вполне себе функционирует а если мы допустим попытаемся зайти на один с портов
всем три тысячи первый работают три тысячи второй вот его нету соответственно все остальные у нас также они доступны эти порты доктор случайным образом из указанного нами диапазон от трёх тысяч до трёх тысяч пяти выбирают те порты которое свободное доступны и в том количестве которое нужны соответственно вот и я указал в шесть портов
было пять и инстанциям соответственно три тысячи второй порту нас никак не задействован но при этом если мы посмотрим запросы здесь у нас все проходе через джинкс айсман перейдём на порту это первое то у нас здесь уже никаких заголовку о том что это прошло через джинкс не нету каким образом мы сделали наш докеров файлы теперь вы можете поставить спокойную совесть
лайк под видео подписаться на канал написать комментарий информацию о том как подержать в их новых видео где пообщаться со мной вы можете найти в описании под видео тому же находят сучка на второй канал где провожу стрима а также в виду своей жизни программистов также ссылочка на группу вконтакте и мой твиттер аккаунт где я кладу интересные новости спасибо что посмотрели это видео пишите кот учитесь всем спасибо
